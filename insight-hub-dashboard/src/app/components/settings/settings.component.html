<!-- src/app/components/settings/settings.component.html -->
<div class="settings-container">
    <h2>Configure Alert Thresholds</h2>
  
    <!-- 1) Sensor Category Dropdown -->
    <div class="form-group">
      <label for="sensor-select">Sensor Category:</label>
      <select id="sensor-select"
              [(ngModel)]="selectedSensor"
              (change)="onSensorSelect(selectedSensor)">
        <option value="" disabled>-- select category --</option>
        <option *ngFor="let c of sensors" [value]="c">{{ c }}</option>
      </select>
    </div>
  
    <!-- 2) Threshold Settings Table -->
    <table *ngIf="selectedSensor" class="metrics-table">
      <thead>
        <tr>
          <th>Metric</th>
          <th>Alert Type</th>
          <th>Threshold</th>
          <th>Unit</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of metrics">
          <!-- Metric Label -->
          <td>{{ m.label }}</td>
  
          <!-- Alert Type: select above/below for numbers, "equals" for enums -->
          <td>
            <ng-container *ngIf="m.type !== 'enum'; else equalsLabel">
              <select [(ngModel)]="form[m.key].alertType">
                <option *ngFor="let t of alertTypes" [value]="t">{{ t }}</option>
              </select>
            </ng-container>
            <ng-template #equalsLabel>
            </ng-template>
          </td>
  
          <!-- Threshold Input / Enum Selector -->
          <td>
            <ng-container [ngSwitch]="m.type">
              <!-- Integer -->
              <input *ngSwitchCase="'integer'" type="number"
                     [(ngModel)]="form[m.key].threshold"
                     (ngModelChange)="validate(m)"
                     [class.invalid]="errors[m.key]" />
  
              <!-- Float -->
              <input *ngSwitchCase="'float'" type="number" step="any"
                     [(ngModel)]="form[m.key].threshold"
                     (ngModelChange)="validate(m)"
                     [class.invalid]="errors[m.key]" />
  
              <!-- Enum -->
              <select *ngSwitchCase="'enum'"
                      [(ngModel)]="form[m.key].threshold"
                      (ngModelChange)="validate(m)"
                      [class.invalid]="errors[m.key]">
                <option value="" disabled>-- select --</option>
                <option *ngFor="let o of m.allowedValues!" [value]="o">{{ o }}</option>
              </select>
            </ng-container>
  
            <!-- Grey example hint for numeric -->
            <small class="param-hint" *ngIf="m.type !== 'enum'">
              e.g. {{ exampleMap[m.key] }} {{ form[m.key].unit || '' }}
            </small>
  
            <!-- Options hint for enum -->
            <small class="param-hint" *ngIf="m.type === 'enum'">
              Options: {{ m.allowedValues!.join(', ') }}
            </small>
  
            <!-- Inline error message -->
            <div class="error-msg" *ngIf="errors[m.key]">{{ errors[m.key] }}</div>
          </td>
  
          <!-- Unit Selector -->
          <td>
            <ng-container *ngIf="m.unitOptions">
              <select [(ngModel)]="form[m.key].unit">
                <option *ngFor="let u of m.unitOptions" [value]="u">{{ u }}</option>
              </select>
            </ng-container>
          </td>
  
          <!-- Adjust Button -->
          <td>
            <button (click)="onAdjust(m)" [disabled]="!!errors[m.key]">
              Adjust
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  